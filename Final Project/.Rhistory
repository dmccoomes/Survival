ses=TRUE)
#age group 40-50
as.numeric(est.40)
as.numeric(c(est.40 - 1.96*se.40,
est.40 + 1.96*se.40))
est.50 <- exp(coef(model.tvc.int.5)["post_tp"] +
4*coef(model.tvc.int.5)["post_tp:age_bin"])
se.50 <- deltamethod(g=~exp((x1 + 4*x2)),
mean=coef(model.tvc.int.5)[c("post_tp", "post_tp:age_bin")],
cov=vcov(model.tvc.int.5)[c("post_tp", "post_tp:age_bin"),
c("post_tp", "post_tp:age_bin")],
ses=TRUE)
#age group 20-30
as.numeric(est.50)
as.numeric(c(est.50 - 1.96*se.50,
est.50 + 1.96*se.50))
#looking at the length of time for platelet recovery
#those that did not recover
summary(subset(luke.tvc, post_tp==0, select=c(tstart, tstop)))
#those that did recover
summary(subset(luke.tvc, post_tp==1, select=c(tstart, tstop)))
output_filename <- ("results")
output_path <- file.path("C:\\Users\\dcoomes\\Dropbox\\Classes\\survival", output_filename)
#run each cox ph model
covariates <- c("age", "male", "donorage", "donormale", "cmv", "donorcmv", "waittime", "disgroup", "fab", "mtx")
univ_formulas <- sapply(covariates,
function(x) as.formula(paste('surv.luke.1 ~', x)))
univ_models <- lapply(univ_formulas, function(x){coxph(x, data=data, ties="exact")})
#get results
univ_results <- lapply(univ_models,
function(x){
x <- summary(x)
p.value <- round(x$wald["pvalue"], 3)
wald.test <- round(x$wald["test"], 3)
beta <- signif(x$coef[1], 3);
HR <- round(x$coef[2], 3);
HR.confint.lower <- round(x$conf.int[,"lower .95"], 3)
HR.confint.upper <- round(x$conf.int[,"upper .95"], 3)
res <- c(HR, HR.confint.lower, HR.confint.upper, p.value)
names(res) <- c("HR", "95% CI lower", "95% CI upper", "p value")
return(res)
})
res <- t(as.data.frame(univ_results, check.names=FALSE))
#put results into a table
kable(res, caption="Cox PH HR using univariate model")  %>%
kable_styling(bootstrap_options = "striped", full_width = FALSE, position="left") %>%
column_spec(1, width="4cm") %>%
row_spec(9:10, bold=T)
p.value <- as.data.frame(summary(model.base.1)$coefficients[,5])
HR <- as.data.frame(summary(model.base.1)$coefficients[,2])
conf.int.low <- as.data.frame(summary(model.base.1)$conf.int[,3])
conf.int.high <- as.data.frame(summary(model.base.1)$conf.int[,4])
est <- cbind(HR, conf.int.low, conf.int.high, p.value)
names(est) <- c("HR", "HR 95% CI low", "HR 95% CI high", "p value")
est <- round(est, digits=3)
kable(est, caption="Cox PH HR using multivariable model")  %>%
kable_styling(bootstrap_options = "striped", full_width = FALSE, position="left") %>%
column_spec(1, width="4cm") %>%
row_spec(9:10, bold=T)
#run each cox ph model
covariates <- c("age", "male", "donorage", "donormale", "cmv", "donorcmv", "waittime", "disgroup", "fab", "mtx")
univ_formulas <- sapply(covariates,
function(x) as.formula(paste('surv.luke.1 ~', x)))
univ_models <- lapply(univ_formulas, function(x){coxph(x, data=data, ties="exact")})
#get results
univ_results <- lapply(univ_models,
function(x){
x <- summary(x)
p.value <- round(x$wald["pvalue"], 3)
wald.test <- round(x$wald["test"], 3)
beta <- signif(x$coef[1], 3);
HR <- round(x$coef[2], 3);
HR.confint.lower <- round(x$conf.int[,"lower .95"], 3)
HR.confint.upper <- round(x$conf.int[,"upper .95"], 3)
res <- c(HR, HR.confint.lower, HR.confint.upper, p.value)
names(res) <- c("HR", "95% CI lower", "95% CI upper", "p value")
return(res)
})
res <- t(as.data.frame(univ_results, check.names=FALSE))
#put results into a table
kable(res, caption="Cox PH HR using univariable models")  %>%
kable_styling(bootstrap_options = "striped", full_width = FALSE, position="left") %>%
column_spec(1, width="4cm") %>%
row_spec(9:10, bold=T)
p.value <- as.data.frame(summary(model.base.1)$coefficients[,5])
HR <- as.data.frame(summary(model.base.1)$coefficients[,2])
conf.int.low <- as.data.frame(summary(model.base.1)$conf.int[,3])
conf.int.high <- as.data.frame(summary(model.base.1)$conf.int[,4])
est <- cbind(HR, conf.int.low, conf.int.high, p.value)
names(est) <- c("HR", "HR 95% CI low", "HR 95% CI high", "p value")
est <- round(est, digits=3)
kable(est, caption="Cox PH HR using multivariable model")  %>%
kable_styling(bootstrap_options = "striped", full_width = FALSE, position="left") %>%
column_spec(1, width="4cm") %>%
row_spec(9:10, bold=T)
#run each cox ph model
covariates <- c("age", "male", "donorage", "donormale", "cmv", "donorcmv", "waittime", "disgroup", "fab", "mtx")
univ_formulas <- sapply(covariates,
function(x) as.formula(paste('surv.luke.1 ~', x)))
univ_models <- lapply(univ_formulas, function(x){coxph(x, data=data, ties="exact")})
#get results
univ_results <- lapply(univ_models,
function(x){
x <- summary(x)
p.value <- round(x$wald["pvalue"], 3)
wald.test <- round(x$wald["test"], 3)
beta <- signif(x$coef[1], 3);
HR <- round(x$coef[2], 3);
HR.confint.lower <- round(x$conf.int[,"lower .95"], 3)
HR.confint.upper <- round(x$conf.int[,"upper .95"], 3)
res <- c(HR, HR.confint.lower, HR.confint.upper, p.value)
names(res) <- c("HR", "95% CI lower", "95% CI upper", "p value")
return(res)
})
res <- t(as.data.frame(univ_results, check.names=FALSE))
#put results into a table
kable(res, caption="Cox PH HR using univariable models")  %>%
kable_styling(bootstrap_options = "striped", full_width = FALSE, position="left") %>%
column_spec(1, width="4cm") %>%
row_spec(9:10, bold=T)
#setting up TVC dataset
luke.tvc = tmerge(data1=data,
data2=data,
id=id,
deltadfs=event(tdfs, deltadfs),
post_tp=tdc(tp))
#setting up TVC dataset with risk of relapse as outcome
luke.tvc.r = tmerge(data1=data,
data2=data,
id=id,
deltadfs=event(tdfs, deltar),
post_tp=tdc(tp))
#fitting TVC Cox PH model with no covariates
surv.luke.tvc <- Surv(luke.tvc$tstart, luke.tvc$tstop, luke.tvc$deltadfs)
model.tvc <- coxph(surv.luke.tvc ~ post_tp, data=luke.tvc)
#with risk of relapse
surv.luke.tvc.r <- Surv(luke.tvc.r$tstart, luke.tvc.r$tstop, luke.tvc.r$deltar)
model.tvc.r <- coxph(surv.luke.tvc.r ~ post_tp, data=luke.tvc.r)
#summary(model.tvc)
#fitting TVC Cox PH model with covariates
model.tvc.cov <- coxph(surv.luke.tvc ~ post_tp + age + donorage + fab + male + donormale + waittime + cmv + donorcmv + mtx, data=luke.tvc)
summary(model.tvc.cov)
#with covariates by strata
luke.tvc$new_age <- luke.tvc$age - 28
luke.tvc$new_donorage <- luke.tvc$donorage - 28
model.tvc.cov.strata <- coxph(surv.luke.tvc ~ post_tp + age + donorage*post_tp + male + donormale + waittime + strata(cmv) + strata(mtx)  + strata(donorcmv) + strata(fab), data=luke.tvc)
summary(model.tvc.cov.strata)
#I think this is the model I want to use
model.tvc.cov.strata.2 <- coxph(surv.luke.tvc ~ post_tp + new_age*post_tp + new_donorage*post_tp + male + donormale + waittime + strata(cmv) + strata(mtx)  + strata(donorcmv) + strata(fab), data=luke.tvc)
summary(model.tvc.cov.strata.2)
#model with relapse as outcome
model.tvc.cov.strata.r <- coxph(surv.luke.tvc.r ~ post_tp + new_age + new_donorage + male + donormale + waittime + strata(cmv) + strata(mtx)  + strata(donorcmv) + strata(fab), data=luke.tvc)
summary(model.tvc.cov.strata.r)
luke.tvc$fab_tp <- luke.tvc$fab*luke.tvc$post_tp
luke.tvc$age_tp <- luke.tvc$age*luke.tvc$post_tp
luke.tvc$donorage_tp <- luke.tvc$donorage*luke.tvc$post_tp
luke.tvc$male_tp <- luke.tvc$male*luke.tvc$post_tp
luke.tvc$donormale_tp <- luke.tvc$donormale*luke.tvc$post_tp
luke.tvc$cmv_tp <- luke.tvc$cmv*luke.tvc$post_tp
luke.tvc$donorcmv_tp <- luke.tvc$donorcmv*luke.tvc$post_tp
luke.tvc$mtx_tp <- luke.tvc$mtx*luke.tvc$post_tp
luke.tvc$waittime_tp <- luke.tvc$waittime*luke.tvc$post_tp
#with interaction terms
# model.tvc.int <- coxph(surv.luke.tvc ~ post_tp + fab_tp + age_tp + donorage_tp + male_tp + donormale_tp + cmv_tp + donorcmv_tp +mtx_tp + waittime_tp, data=luke.tvc)
#
# summary(model.tvc.int)
#better one with interaction terms
model.tvc.int.2 <- coxph(surv.luke.tvc ~ post_tp + age*post_tp + donorage*post_tp + male*post_tp + donormale*post_tp + waittime*post_tp + cmv*post_tp + donorcmv*post_tp + mtx*post_tp + fab*post_tp, data=luke.tvc)
summary(model.tvc.int.2)
#stratified and interactions
model.tvc.int.3 <- coxph(surv.luke.tvc ~ post_tp + age*post_tp + donorage*post_tp + male + donormale + waittime + cmv + donorcmv + mtx + fab, data=luke.tvc)
summary(model.tvc.int.3)
data$new_age <- data$age - 28
data$age_old <- ifelse(data$age > 28, 1, 0)
data$donorage_old <- ifelse(data$donorage > 28, 1, 0)
#first, fit a Cox PH model including all baseline covariates
model.base.1 <- coxph(surv.luke.1 ~ age + male + donorage + donormale + cmv + donorcmv + waittime + disgroup + fab + mtx, data=data, ties="exact")
summary(model.base.1)
#trying a Cox PH model that includes hospital as a stratified variable
model.base.2 <- coxph(surv.luke.1 ~ age + male + donorage + donormale + cmv + donorcmv + waittime + disgroup + fab + mtx + strata(hospital), data=data)
#creating Cox PH model that includes country as a stratified variable
#creating country variable
data$country_us = ifelse((data$hospital==1 | data$hospital==4), 1, 0)
model.base.3 <- coxph(surv.luke.1 ~ age + male + donorage + donormale + cmv + donorcmv + waittime + disgroup + fab + mtx + strata(country_us), data=data)
#Creating model with just FAB and not including disease group
model.base.4 <- coxph(surv.luke.1 ~ age + male + donorage + donormale + cmv + donorcmv + waittime + fab + mtx, data=data)
summary(model.base.4)
#second, are any of these variables associated with difference by themselves - I did this in the box above
# model.base.age <- coxph(surv.luke.1 ~ age, data=data)
# model.base.male <- coxph(surv.luke.1 ~ male, data=data)
# model.base.donorage <- coxph(surv.luke.1 ~ donorage, data=data)
# model.base.donormale <- coxph(surv.luke.1 ~ donormale, data=data)
# model.base.cmv <- coxph(surv.luke.1 ~ cmv, data=data)
# model.base.donorcmv <- coxph(surv.luke.1 ~ donorcmv, data=data)
# model.base.waittime <- coxph(surv.luke.1 ~ waittime, data=data)
# model.base.disgroup <- coxph(surv.luke.1 ~ disgroup, data=data)
# model.base.fab <- coxph(surv.luke.1 ~ fab, data=data)
# model.base.mtx <- coxph(surv.luke.1 ~ mtx, data=data)
#
# summary(model.base.age)
# summary(model.base.male)
# summary(model.base.donorage)
# summary(model.base.donormale)
# summary(model.base.cmv)
# summary(model.base.donorcmv)
# summary(model.base.waittime)
# summary(model.base.disgroup)
# summary(model.base.fab)
# summary(model.base.mtx)
#build table of z-scores for individual models
summary(model.base.1)
#mtx doesn't vary by hospital - only the hospitals in Australia used MTX as a prophylactic
#this means that we can't include MTX and hospital in the analysis - they are the same
summary(model.base.2)
summary(model.base.3)
#FAB is significant (0.0160) and MTX is significant (0.080).
p.value <- as.data.frame(summary(model.base.1)$coefficients[,5])
HR <- as.data.frame(summary(model.base.1)$coefficients[,2])
conf.int.low <- as.data.frame(summary(model.base.1)$conf.int[,3])
conf.int.high <- as.data.frame(summary(model.base.1)$conf.int[,4])
est <- cbind(HR, conf.int.low, conf.int.high, p.value)
names(est) <- c("HR", "HR 95% CI low", "HR 95% CI high", "p value")
est <- round(est, digits=3)
kable(est, caption="Cox PH HR using multivariable model")  %>%
kable_styling(bootstrap_options = "striped", full_width = FALSE, position="left") %>%
column_spec(1, width="4cm") %>%
row_spec(9:10, bold=T)
par(mfrow=c(3, 2))
#plot KM curve
#age
survfit.luke.age_old <- survfit(surv.luke.1 ~ age_old, data=data, conf.type="log-log")
plot(survfit.luke.age_old,
conf.int=FALSE,
main="Age (p=0.1)",
#cex.main = 0.8,
ylab = "Survival probability",
cex.lab = 0.7,
xlab = "Time (days)",
col = c("blue", "red"),
lty = c("solid", "dashed"),
lwd = c(1,1))
legend("topright", c("Younger (28 and younger)", "Older (>28)"), col=c("blue", "red"), lwd=c(2,2), lty=c("solid", "dashed"), cex=0.6)
#sex
survfit.luke.male <- survfit(surv.luke.1 ~ male, data=data, conf.type="log-log")
plot(survfit.luke.male,
conf.int=FALSE,
main="Sex (p=0.3)",
#cex.main = 0.8,
ylab = "Survival probability",
xlab = "Time (days)",
cex.lab = 0.7,
col = c("blue", "red"),
lty = c("solid", "dashed"),
lwd = c(1,1))
legend("topright", c("Female", "Male"), col=c("blue", "red"), lwd=c(2,2), lty=c("solid", "dashed"), cex=0.6)
#donor age
survfit.luke.donorage_old <- survfit(surv.luke.1 ~ donorage_old, data=data, conf.type="log-log")
plot(survfit.luke.donorage_old,
conf.int=FALSE,
main="Age of donor (p=0.7)",
#cex.main = 0.8,
ylab = "Survival probability",
xlab = "Time (days)",
cex.lab = 0.7,
col = c("blue", "red"),
lty = c("solid", "dashed"),
lwd = c(1,1))
legend("topright", c("Younger (28 and younger)", "Older (>28)"), col=c("blue", "red"), lwd=c(2,2), lty=c("solid", "dashed"), cex=0.6)
#donor sex
survfit.luke.donormale <- survfit(surv.luke.1 ~ donormale, data=data, conf.type="log-log")
plot(survfit.luke.donormale,
conf.int=FALSE,
main="Sex of donor (p=1)",
#cex.main = 0.8,
ylab = "Survival probability",
xlab = "Time (days)",
cex.lab = 0.7,
col = c("blue", "red"),
lty = c("solid", "dashed"),
lwd = c(1,1))
legend("topright", c("Female", "Male"), col=c("blue", "red"), lwd=c(2,2), lty=c("solid", "dashed"), cex=0.6)
#cmv
survfit.luke.cmv <- survfit(surv.luke.1 ~ cmv, data=data, conf.type="log-log")
plot(survfit.luke.cmv,
conf.int=FALSE,
main="CMV (p=0.5)",
#cex.main = 0.8,
ylab = "Survival probability",
xlab = "Time (days)",
cex.lab = 0.7,
col = c("blue", "red"),
lty = c("solid", "dashed"),
lwd = c(1,1))
legend("topright", c("CMV negative", "CMV positive"), col=c("blue", "red"), lwd=c(2,2), lty=c("solid", "dashed"), cex=0.6)
#donor cmv
survfit.luke.donorcmv <- survfit(surv.luke.1 ~ donorcmv, data=data, conf.type="log-log")
plot(survfit.luke.donorcmv,
conf.int=FALSE,
main="CMV of donor (p=0.8)",
#cex.main = 0.8,
ylab = "Survival probability",
xlab = "Time (days)",
cex.lab = 0.7,
col = c("blue", "red"),
lty = c("solid", "dashed"),
lwd = c(1,1))
legend("topright", c("CMV negative", "CMV positive"), col=c("blue", "red"), lwd=c(2,2), lty=c("solid", "dashed"), cex=0.6)
#waittime
survfit.luke.waittime_long <- survfit(surv.luke.1 ~ waittime_long, data=data, conf.type="log-log")
plot(survfit.luke.waittime_long,
conf.int=FALSE,
main="Transplant wait time (p=0.6)",
#cex.main = 0.8,
ylab = "Survival probability",
xlab = "Time (days)",
cex.lab = 0.7,
col = c("blue", "red"),
lty = c("solid", "dashed"),
lwd = c(1,1))
legend("topright", c("Short wait time (less than 178 days)", "Long wait time (>178 days"), col=c("blue", "red"), lwd=c(2,2), lty=c("solid", "dashed"), cex=0.6)
#disease group
plot(survfit.luke.disgroup,
conf.int=FALSE,
main="Disease group (p=0.001*)",
#cex.main = 0.8,
ylab = "Survival probability",
xlab = "Time (days)",
cex.lab = 0.7,
col = c("blue", "orange", "red"),
lty = c("solid", "dashed", "solid"),
lwd = c(1,1,1))
legend("topright", c("ALL", "AML low", "AML high"), col=c("blue", "orange", "red"), lwd=c(2,2,2), lty=c("solid", "dashed", "solid"), cex=0.6)
#FAB
plot(survfit.luke.fab,
conf.int=FALSE,
main="FAB classification (p=0.004*)",
#cex.main = 0.8,
ylab = "Survival probability",
xlab = "Time (days)",
cex.lab = 0.7,
col = c("blue", "red"),
lty = c("solid", "dashed"),
lwd = c(1,1))
legend("topright", c("FAB 4 or 5 & AML", "other"), col=c("blue", "red"), lwd=c(2,2), lty=c("solid", "dashed"), cex=0.6)
#MTX
plot(survfit.luke.mtx,
conf.int=FALSE,
main="Methotrexate use (p=0.09*)",
#cex.main = 0.8,
ylab = "Survival probability",
xlab = "Time (days)",
cex.lab = 0.7,
col = c("blue", "red"),
lty = c("solid", "dashed"),
lwd = c(1,1))
legend("topright", c("No methotrexate use", "Methotrexate use"), col=c("blue", "red"), lwd=c(2,2), lty=c("solid", "dashed"), cex=0.6)
par(mfrow=c(2, 3))
#plot KM curve
#age
survfit.luke.age_old <- survfit(surv.luke.1 ~ age_old, data=data, conf.type="log-log")
plot(survfit.luke.age_old,
conf.int=FALSE,
main="Age (p=0.1)",
#cex.main = 0.8,
ylab = "Survival probability",
cex.lab = 0.7,
xlab = "Time (days)",
col = c("blue", "red"),
lty = c("solid", "dashed"),
lwd = c(1,1))
legend("topright", c("Younger (28 and younger)", "Older (>28)"), col=c("blue", "red"), lwd=c(2,2), lty=c("solid", "dashed"), cex=0.6)
#sex
survfit.luke.male <- survfit(surv.luke.1 ~ male, data=data, conf.type="log-log")
plot(survfit.luke.male,
conf.int=FALSE,
main="Sex (p=0.3)",
#cex.main = 0.8,
ylab = "Survival probability",
xlab = "Time (days)",
cex.lab = 0.7,
col = c("blue", "red"),
lty = c("solid", "dashed"),
lwd = c(1,1))
legend("topright", c("Female", "Male"), col=c("blue", "red"), lwd=c(2,2), lty=c("solid", "dashed"), cex=0.6)
#donor age
survfit.luke.donorage_old <- survfit(surv.luke.1 ~ donorage_old, data=data, conf.type="log-log")
plot(survfit.luke.donorage_old,
conf.int=FALSE,
main="Age of donor (p=0.7)",
#cex.main = 0.8,
ylab = "Survival probability",
xlab = "Time (days)",
cex.lab = 0.7,
col = c("blue", "red"),
lty = c("solid", "dashed"),
lwd = c(1,1))
legend("topright", c("Younger (28 and younger)", "Older (>28)"), col=c("blue", "red"), lwd=c(2,2), lty=c("solid", "dashed"), cex=0.6)
#donor sex
survfit.luke.donormale <- survfit(surv.luke.1 ~ donormale, data=data, conf.type="log-log")
plot(survfit.luke.donormale,
conf.int=FALSE,
main="Sex of donor (p=1)",
#cex.main = 0.8,
ylab = "Survival probability",
xlab = "Time (days)",
cex.lab = 0.7,
col = c("blue", "red"),
lty = c("solid", "dashed"),
lwd = c(1,1))
legend("topright", c("Female", "Male"), col=c("blue", "red"), lwd=c(2,2), lty=c("solid", "dashed"), cex=0.6)
#cmv
survfit.luke.cmv <- survfit(surv.luke.1 ~ cmv, data=data, conf.type="log-log")
plot(survfit.luke.cmv,
conf.int=FALSE,
main="CMV (p=0.5)",
#cex.main = 0.8,
ylab = "Survival probability",
xlab = "Time (days)",
cex.lab = 0.7,
col = c("blue", "red"),
lty = c("solid", "dashed"),
lwd = c(1,1))
legend("topright", c("CMV negative", "CMV positive"), col=c("blue", "red"), lwd=c(2,2), lty=c("solid", "dashed"), cex=0.6)
#donor cmv
survfit.luke.donorcmv <- survfit(surv.luke.1 ~ donorcmv, data=data, conf.type="log-log")
plot(survfit.luke.donorcmv,
conf.int=FALSE,
main="CMV of donor (p=0.8)",
#cex.main = 0.8,
ylab = "Survival probability",
xlab = "Time (days)",
cex.lab = 0.7,
col = c("blue", "red"),
lty = c("solid", "dashed"),
lwd = c(1,1))
legend("topright", c("CMV negative", "CMV positive"), col=c("blue", "red"), lwd=c(2,2), lty=c("solid", "dashed"), cex=0.6)
#waittime
survfit.luke.waittime_long <- survfit(surv.luke.1 ~ waittime_long, data=data, conf.type="log-log")
plot(survfit.luke.waittime_long,
conf.int=FALSE,
main="Transplant wait time (p=0.6)",
#cex.main = 0.8,
ylab = "Survival probability",
xlab = "Time (days)",
cex.lab = 0.7,
col = c("blue", "red"),
lty = c("solid", "dashed"),
lwd = c(1,1))
legend("topright", c("Short wait time (less than 178 days)", "Long wait time (>178 days"), col=c("blue", "red"), lwd=c(2,2), lty=c("solid", "dashed"), cex=0.6)
#disease group
plot(survfit.luke.disgroup,
conf.int=FALSE,
main="Disease group (p=0.001*)",
#cex.main = 0.8,
ylab = "Survival probability",
xlab = "Time (days)",
cex.lab = 0.7,
col = c("blue", "orange", "red"),
lty = c("solid", "dashed", "solid"),
lwd = c(1,1,1))
legend("topright", c("ALL", "AML low", "AML high"), col=c("blue", "orange", "red"), lwd=c(2,2,2), lty=c("solid", "dashed", "solid"), cex=0.6)
#FAB
plot(survfit.luke.fab,
conf.int=FALSE,
main="FAB classification (p=0.004*)",
#cex.main = 0.8,
ylab = "Survival probability",
xlab = "Time (days)",
cex.lab = 0.7,
col = c("blue", "red"),
lty = c("solid", "dashed"),
lwd = c(1,1))
legend("topright", c("FAB 4 or 5 & AML", "other"), col=c("blue", "red"), lwd=c(2,2), lty=c("solid", "dashed"), cex=0.6)
#MTX
plot(survfit.luke.mtx,
conf.int=FALSE,
main="Methotrexate use (p=0.09*)",
#cex.main = 0.8,
ylab = "Survival probability",
xlab = "Time (days)",
cex.lab = 0.7,
col = c("blue", "red"),
lty = c("solid", "dashed"),
lwd = c(1,1))
legend("topright", c("No methotrexate use", "Methotrexate use"), col=c("blue", "red"), lwd=c(2,2), lty=c("solid", "dashed"), cex=0.6)
model.tvc.cov.strata.2 <- coxph(surv.luke.tvc ~ post_tp + new_age*post_tp + new_donorage*post_tp + male + donormale + waittime + strata(cmv) + strata(mtx)  + strata(donorcmv) + strata(fab), data=luke.tvc)
summary(model.tvc.cov.strata.2)
luke.tvc.r
luke.tvc.delay = tmerge(data1=data,
data2=data,
id=id,
deltadfs=event(tdfs, deltadfs),
post_tp=tdc(tp),
delay=14)
luke.tvc.delay = tmerge(data1=data,
data2=data,
id=id,
deltadfs=event(tdfs, deltadfs),
post_tp=tdc(tp),
options=list(delay=14))
surv.luke.tvc.delay <- Surv(luke.tvc.delay$tstart, luke.tvc.delay$tstop, luke.tvc.delay$deltar)
model.tvc.delay <- coxph(surv.luke.tvc.delay ~ post_tp, data=luke.tvc.delay)
model.tvc.cov.strata.delay <- coxph(surv.luke.tvc.delay ~ post_tp + new_age*post_tp + new_donorage*post_tp + male + donormale + waittime + strata(cmv) + strata(mtx)  + strata(donorcmv) + strata(fab), data=luke.tvc)
summary(model.tvc.cov.strata.delay)
#looking at the length of time for platelet recovery
#those that did not recover
summary(subset(luke.tvc, post_tp==0, select=c(tstart, tstop)))
#those that did recover
summary(subset(luke.tvc, post_tp==1, select=c(tstart, tstop)))
model.tvc.cov.strata.2 <- coxph(surv.luke.tvc ~ post_tp + new_age*post_tp + new_donorage*post_tp + male + donormale + waittime + strata(cmv) + strata(mtx)  + strata(donorcmv) + strata(fab), data=luke.tvc)
summary(model.tvc.cov.strata.2)
table(data$mtx, data$hospital)
