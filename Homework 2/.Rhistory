knitr::opts_chunk$set(echo = FALSE)
library(survival)
library(flexsurv)
knitr::opts_chunk$set(echo = FALSE)
if (!require(flexsurv)) load.packages("flexsurv")
knitr::opts_chunk$set(echo = FALSE)
if (!require(flexsurv)) install.packages("flexsurv")
library(survival)
library(flexsurv)
library(survMisc) # for Wilcoxon-Gehan-Breslow test
knitr::opts_chunk$set(echo = FALSE)
if (!require(flexsurv)) install.packages("flexsurv")
if (!require(survMisc)) install.packages("survMisc")
library(survival)
library(flexsurv)
library(survMisc) # for Wilcoxon-Gehan-Breslow test
source("/Users/david/Documents/GitHub/Survival/Homework 3/getmedianres.R")
source("\\pacific\dcoomes\My Documents\GitHub\Survival\Homework 3\getmedianres.R")
source("\\pacific\\dcoomes\\My Documents\\GitHub\\Survival\\Homework 3\\getmedianres.R")
source("C:\\dcoomes\\My Documents\\GitHub\\Survival\\Homework 3\\getmedianres.R")
source("C:\\My Documents\\GitHub\\Survival\\Homework 3\\getmedianres.R")
source("C:\\Users\\dcoomes\\My Documents\\GitHub\\Survival\\Homework 3\\getmedianres.R")
source("C:\\Users\\dcoomes\\My Documents\\GitHub\\Survival\\Homework 3\\getmedianres.R")
link="https://github.com/dmccoomes/Survival/raw/master/Homework%203/getmedianres.R"
source(url(link))
library(survival)
library(flexsurv)
library(survMisc) # for Wilcoxon-Gehan-Breslow test
link="https://github.com/dmccoomes/Survival/raw/master/Homework%203/getmedianres.R"
source(url(link))
#source("C:\\Users\\dcoomes\\My Documents\\GitHub\\Survival\\Homework 3\\getmedianres.R")
luke <- read.csv("/Users/david/Documents/GitHub/Survival/Homework 3/ccg803.csv", header=TRUE)
link2="https://github.com/dmccoomes/Survival/raw/master/Homework%203/ccg803.csv"
luke <- read.csv(url(link), header=TRUE)
#luke <- read.csv("/Users/david/Documents/GitHub/Survival/Homework 3/ccg803.csv", header=TRUE)
surv.luke <- Surv(time=luke$duration, event=luke$relapse, type="right")
summary(luke$duration)
link2="https://github.com/dmccoomes/Survival/raw/master/Homework%203/ccg803.csv"
luke <- read.csv(url(link), header=TRUE)
#luke <- read.csv("/Users/david/Documents/GitHub/Survival/Homework 3/ccg803.csv", header=TRUE)
surv.luke <- Surv(time=luke$duration, event=luke$relapse, type="right")
link2="https://github.com/dmccoomes/Survival/raw/master/Homework%203/ccg803.csv"
luke <- read_csv(url(link), header=TRUE)
link2="https://github.com/dmccoomes/Survival/raw/master/Homework%203/ccg803.csv"
luke <- read_csv(url(link))
#there is a problem reading in the data from github
#link2="https://github.com/dmccoomes/Survival/raw/master/Homework%203/ccg803.csv"
#luke <- read.csv(url(link), header=TRUE)
#laptop data
#luke <- read.csv("/Users/david/Documents/GitHub/Survival/Homework 3/ccg803.csv", header=TRUE)
#computer in office
luke <- read.csv("C:\Users\dcoomes\Dropbox\Classes\survival\Data\ccg803", header=TRUE)
#there is a problem reading in the data from github
#link2="https://github.com/dmccoomes/Survival/raw/master/Homework%203/ccg803.csv"
#luke <- read.csv(url(link), header=TRUE)
#laptop data
#luke <- read.csv("/Users/david/Documents/GitHub/Survival/Homework 3/ccg803.csv", header=TRUE)
#computer in office
luke <- read.csv("C:\\Users\\dcoomes\\Dropbox\\Classes\\survival\\Data\\ccg803", header=TRUE)
#there is a problem reading in the data from github
#link2="https://github.com/dmccoomes/Survival/raw/master/Homework%203/ccg803.csv"
#luke <- read.csv(url(link), header=TRUE)
#laptop data
#luke <- read.csv("/Users/david/Documents/GitHub/Survival/Homework 3/ccg803.csv", header=TRUE)
#computer in office
luke <- read.csv("C:/Users/dcoomes/Dropbox/Classes/survival/Data/ccg803", header=TRUE)
#there is a problem reading in the data from github
#link2="https://github.com/dmccoomes/Survival/raw/master/Homework%203/ccg803.csv"
#luke <- read.csv(url(link), header=TRUE)
#laptop data
#luke <- read.csv("/Users/david/Documents/GitHub/Survival/Homework 3/ccg803.csv", header=TRUE)
#computer in office
luke <- read.csv("C:\Users\dcoomes\Dropbox\Classes\survival\Data\ccg803", header=TRUE)
#there is a problem reading in the data from github
#link2="https://github.com/dmccoomes/Survival/raw/master/Homework%203/ccg803.csv"
#luke <- read.csv(url(link), header=TRUE)
#laptop data
#luke <- read.csv("/Users/david/Documents/GitHub/Survival/Homework 3/ccg803.csv", header=TRUE)
#computer in office
luke <- read.csv("C:\\Users\dcoomes\Dropbox\Classes\survival\Data\ccg803", header=TRUE)
#there is a problem reading in the data from github
#link2="https://github.com/dmccoomes/Survival/raw/master/Homework%203/ccg803.csv"
#luke <- read.csv(url(link), header=TRUE)
#laptop data
#luke <- read.csv("/Users/david/Documents/GitHub/Survival/Homework 3/ccg803.csv", header=TRUE)
#computer in office
luke <- read.csv("C:\\Users\\dcoomes\\Dropbox\\Classes\\survival\\Data\\ccg803", header=TRUE)
#there is a problem reading in the data from github
#link2="https://github.com/dmccoomes/Survival/raw/master/Homework%203/ccg803.csv"
#luke <- read.csv(url(link), header=TRUE)
#laptop data
#luke <- read.csv("/Users/david/Documents/GitHub/Survival/Homework 3/ccg803.csv", header=TRUE)
#computer in office
luke <- read.csv("C:\\Users\\dcoomes\\Dropbox\\Classes\\survival\\Data\\ccg803.csv", header=TRUE)
surv.luke <- Surv(time=luke$duration, event=luke$relapse, type="right")
model.1 <- coxph(surv.luke ~ rx, data=luke)
summary(model.1)
summary(model.1)
knitr::opts_chunk$set(echo = FALSE)
if (!require(flexsurv)) install.packages("flexsurv")
if (!require(survMisc)) install.packages("survMisc")
library(survival)
library(flexsurv)
library(survMisc) # for Wilcoxon-Gehan-Breslow test
link="https://github.com/dmccoomes/Survival/raw/master/Homework%203/getmedianres.R"
source(url(link))
#source("C:\\Users\\dcoomes\\My Documents\\GitHub\\Survival\\Homework 3\\getmedianres.R")
#there is a problem reading in the data from github
#link2="https://github.com/dmccoomes/Survival/raw/master/Homework%203/ccg803.csv"
#luke <- read.csv(url(link), header=TRUE)
#laptop data
#luke <- read.csv("/Users/david/Documents/GitHub/Survival/Homework 3/ccg803.csv", header=TRUE)
#computer in office
luke <- read.csv("C:\\Users\\dcoomes\\Dropbox\\Classes\\survival\\Data\\ccg803.csv", header=TRUE)
surv.luke <- Surv(time=luke$duration, event=luke$relapse, type="right")
model.1 <- coxph(surv.luke ~ rx, data=luke)
summary(model.1)
model.2 <- coxph(surv.luke ~ rx + wbc + age, data=luke)
summary(model.2)
#creating interaction variables
luke$wbc_high <- (luke$wbc >= 100)*luke$wbc
luke$wbc_low <- (luke$wbc < 100)*luke$wbc
luke$rx_high <- (luke$wbc >= 100)*luke$rx
luke$rx_low <- (luke$wbc < 100)*luke$rx
#model with interaction
model.3_large <- coxph(surv.luke ~ wbc_high + wbc_low + rx_high + rx_low + age, data = luke)
summary(model.3_large)
model.3_large_est <- exp(coef(model.3_large)["rx_high"])
model.3_large_est
#model without interaction
model.3_small <- coxph(surv.luke ~ rx + wbc_high + wbc_low + age, data=luke)
summary(model.3_small)
#performing test to determine interaction
as.numeric(2 * (logLik(model.3_large) - logLik(model.3_small)))
#test statistic is 5.526
model.4 <- coxph(surv.luke ~ rx + wbc + age + strata(institution), data=luke)
summary(model.4)
plot(survfit(model.2,
newdata=data.frame(rx=1, age=5, wbc=45)),
conf.int=FALSE, lwd=2, col="blue", lty="dashed",
xlab="Days", ylab="Survival Probability")
lines(survfit(model.2,
newdata=data.frame(rx=0, age=5, wbc=45)),
conf.int=FALSE, lwd=2, col="blue", lty="solid")
lines(survfit(model.2,
newdata=data.frame(rx=1, age=5, wbc=210)),
conf.int=FALSE, lwd=2, col="orange", lty="dashed")
lines(survfit(model.2,
newdata=data.frame(rx=0, age=5, wbc=210)),
conf.int=FALSE, lwd=2, col="orange", lty="solid")
legend("topright", cex=0.7,
legend=c("treated, age=5, wbc=45",
"untreated, age=5, wbc=45",
"treated, age=5, wbc=210",
"untreated, age=5, wbc=210"),
col=c("blue", "blue", "orange", "orange"),
lty=c("dashed", "solid", "dashed", "solid"),
lwd=c(2))
link = "https://github.com/dmccoomes/Survival/raw/master/Homework%201/addicts.csv"
adix <- read.csv(link)
surv.adix <- Surv(time=adix$time, event=adix$event, type="right")
survfit.adix <- survfit(surv.adix ~ 1, data=adix, conf.type = "log-log")
model.2.1 <- coxph(surv.adix ~ dose + prison + clinic, data=adix)
summary(model.2.1)
model.2.2 <- coxph(surv.adix ~ dose + prison + strata(clinic), data=adix)
summary(model.2.2)
model.2.3 <- coxph(surv.adix ~ dose + strata(clinic) + dose*prison, data=adix)
summary(model.2.3)
model.2.3 <- coxph(surv.adix ~ dose + strata(clinic) + dose*prison, data=adix)
summary(model.2.3)
model.2.3 <- coxph(surv.adix ~ dose + prison + strata(clinic) + dose*prison, data=adix)
summary(model.2.3)
est <- exp(60*coef(model.2.3)["dose"] +
coef(model.2.3)["prison"] +
100*coef(model.2.3)[dose:prison])
model.2.3 <- coxph(surv.adix ~ dose + prison + strata(clinic) + dose*prison, data=adix)
summary(model.2.3)
model.2.3 <- coxph(surv.adix ~ dose + prison + strata(clinic) + dose*prison, data=adix)
summary(model.2.3)
est <- exp(60 * coef(model.2.3)["dose"] +
coef(model.2.3)["prison"] +
100 * coef(model.2.3)["dose:prison"])
se <- deltamethod(g=~exp((60*x1 + x2 + 100*x3)),
mean=coef(model.2.3)[c("dose", "prison", "dose:prison")],
cov=vcov(model.2.3)[c("dose", "prison", "dose:prison"),
c("dose", "prison", "dose:prison")],
ses=TRUE)
library(survival)
library(flexsurv)
library(survMisc) # for Wilcoxon-Gehan-Breslow test
library(msm)
if (!require(flexsurv)) install.packages("flexsurv")
if (!require(survMisc)) install.packages("survMisc")
if (!require(msm)) install.packages("msm")
library(survival)
library(flexsurv)
library(survMisc) # for Wilcoxon-Gehan-Breslow test
library(msm)
#link="https://github.com/dmccoomes/Survival/raw/master/Homework%203/getmedianres.R"
#source(url(link))
#source("C:\\Users\\dcoomes\\My Documents\\GitHub\\Survival\\Homework 3\\getmedianres.R")
knitr::opts_chunk$set(echo = FALSE)
if (!require(flexsurv)) install.packages("flexsurv")
if (!require(survMisc)) install.packages("survMisc")
if (!require(msm)) install.packages("msm")
library(survival)
library(flexsurv)
library(survMisc) # for Wilcoxon-Gehan-Breslow test
library(msm)
#link="https://github.com/dmccoomes/Survival/raw/master/Homework%203/getmedianres.R"
#source(url(link))
#source("C:\\Users\\dcoomes\\My Documents\\GitHub\\Survival\\Homework 3\\getmedianres.R")
#there is a problem reading in the data from github
#link2="https://github.com/dmccoomes/Survival/raw/master/Homework%203/ccg803.csv"
#luke <- read.csv(url(link), header=TRUE)
#laptop data
#luke <- read.csv("/Users/david/Documents/GitHub/Survival/Homework 3/ccg803.csv", header=TRUE)
#computer in office
luke <- read.csv("C:\\Users\\dcoomes\\Dropbox\\Classes\\survival\\Data\\ccg803.csv", header=TRUE)
surv.luke <- Surv(time=luke$duration, event=luke$relapse, type="right")
model.1 <- coxph(surv.luke ~ rx, data=luke)
summary(model.1)
model.2 <- coxph(surv.luke ~ rx + wbc + age, data=luke)
summary(model.2)
#creating interaction variables
luke$wbc_high <- (luke$wbc >= 100)*luke$wbc
luke$wbc_low <- (luke$wbc < 100)*luke$wbc
luke$rx_high <- (luke$wbc >= 100)*luke$rx
luke$rx_low <- (luke$wbc < 100)*luke$rx
#model with interaction
model.3_large <- coxph(surv.luke ~ wbc_high + wbc_low + rx_high + rx_low + age, data = luke)
summary(model.3_large)
model.3_large_est <- exp(coef(model.3_large)["rx_high"])
model.3_large_est
#model without interaction
model.3_small <- coxph(surv.luke ~ rx + wbc_high + wbc_low + age, data=luke)
summary(model.3_small)
#performing test to determine interaction
as.numeric(2 * (logLik(model.3_large) - logLik(model.3_small)))
#test statistic is 5.526
model.4 <- coxph(surv.luke ~ rx + wbc + age + strata(institution), data=luke)
summary(model.4)
plot(survfit(model.2,
newdata=data.frame(rx=1, age=5, wbc=45)),
conf.int=FALSE, lwd=2, col="blue", lty="dashed",
xlab="Days", ylab="Survival Probability")
lines(survfit(model.2,
newdata=data.frame(rx=0, age=5, wbc=45)),
conf.int=FALSE, lwd=2, col="blue", lty="solid")
lines(survfit(model.2,
newdata=data.frame(rx=1, age=5, wbc=210)),
conf.int=FALSE, lwd=2, col="orange", lty="dashed")
lines(survfit(model.2,
newdata=data.frame(rx=0, age=5, wbc=210)),
conf.int=FALSE, lwd=2, col="orange", lty="solid")
legend("topright", cex=0.7,
legend=c("treated, age=5, wbc=45",
"untreated, age=5, wbc=45",
"treated, age=5, wbc=210",
"untreated, age=5, wbc=210"),
col=c("blue", "blue", "orange", "orange"),
lty=c("dashed", "solid", "dashed", "solid"),
lwd=c(2))
link = "https://github.com/dmccoomes/Survival/raw/master/Homework%201/addicts.csv"
adix <- read.csv(link)
surv.adix <- Surv(time=adix$time, event=adix$event, type="right")
survfit.adix <- survfit(surv.adix ~ 1, data=adix, conf.type = "log-log")
model.2.1 <- coxph(surv.adix ~ dose + prison + clinic, data=adix)
summary(model.2.1)
model.2.2 <- coxph(surv.adix ~ dose + prison + strata(clinic), data=adix)
summary(model.2.2)
model.2.3 <- coxph(surv.adix ~ dose + prison + strata(clinic) + dose*prison, data=adix)
summary(model.2.3)
est <- exp(60 * coef(model.2.3)["dose"] +
coef(model.2.3)["prison"] +
100 * coef(model.2.3)["dose:prison"])
se <- deltamethod(g=~exp((60*x1 + x2 + 100*x3)),
mean=coef(model.2.3)[c("dose", "prison", "dose:prison")],
cov=vcov(model.2.3)[c("dose", "prison", "dose:prison"),
c("dose", "prison", "dose:prison")],
ses=TRUE)
as.numeric(est)
est <- exp(60 * coef(model.2.3)["dose"] +
coef(model.2.3)["prison"] +
100 * coef(model.2.3)["dose:prison"])
se <- deltamethod(g=~exp((60*x1 + x2 + 100*x3)),
mean=coef(model.2.3)[c("dose", "prison", "dose:prison")],
cov=vcov(model.2.3)[c("dose", "prison", "dose:prison"),
c("dose", "prison", "dose:prison")],
ses=TRUE)
as.numeric(est)
as.numeric(c(est - 1.196*se,
est + 1.96*se))
knitr::opts_chunk$set(echo = TRUE)
if (!require(kableExtra)) install.packages("kableExtra")
if (!require(flexsurv)) install.packages("flexsurv")
if (!require(survMisc)) install.packages("survMisc")
if (!require(msm)) install.packages("msm")
library(tidyverse)
library(knitr)
library(kableExtra)
#source("getmedianres.R")
library(survival)
library(flexsurv)
library(survMisc) # for Wilcoxon-Gehan-Breslow test
library(msm)
link = "https://github.com/dmccoomes/Survival/raw/master/Final%20Project/Data/bmt.csv"
data <- read.csv(url(link), header=TRUE)
link = "https://github.com/dmccoomes/Survival/raw/master/Final%20Project/Data/bmt.csv"
data <- read.csv(url(link), header=TRUE)
summary(data)
surv.luke.1 <- Surv(time=data$tdfs, event=data$deltadfs, type="right")
#first, fit a Cox PH model including all baseline covariates
model.base.1 <- coxph(surv.luke.1 ~ age + male + donorage + donormale + cmv + donorcmv + waittime + disgroup + fab + mtx, data=data)
summary(model.base.1)
#first, fit a Cox PH model including all baseline covariates
model.base.1 <- coxph(surv.luke.1 ~ age + male + donorage + donormale + cmv + donorcmv + waittime + disgroup + fab + mtx, data=data)
summary(model.base.1)
#second, are any of these variables associated with difference by themselves
model.base.age <- coxph(surv.luke.1 ~ age, data=data)
model.base.male <- coxph(surv.luke.1 ~ male, data=data)
model.base.donorage <- coxph(surv.luke.1 ~ donorage, data=data)
model.base.donormale <- coxph(surv.luke.1 ~ donormale, data=data)
model.base.cmv <- coxph(surv.luke.1 ~ cmv, data=data)
model.base.donorcmv <- coxph(surv.luke.1 ~ donorcmv, data=data)
model.base.waittime <- coxph(surv.luke.1 ~ waittime, data=data)
model.base.disgroup <- coxph(surv.luke.1 ~ disgroup, data=data)
model.base.fab <- coxph(surv.luke.1 ~ fab, data=data)
model.base.mtx <- coxph(surv.luke.1 ~ mtx, data=data)
#first, fit a Cox PH model including all baseline covariates
model.base.1 <- coxph(surv.luke.1 ~ age + male + donorage + donormale + cmv + donorcmv + waittime + disgroup + fab + mtx, data=data)
summary(model.base.1)
#second, are any of these variables associated with difference by themselves
model.base.age <- coxph(surv.luke.1 ~ age, data=data)
model.base.male <- coxph(surv.luke.1 ~ male, data=data)
model.base.donorage <- coxph(surv.luke.1 ~ donorage, data=data)
model.base.donormale <- coxph(surv.luke.1 ~ donormale, data=data)
model.base.cmv <- coxph(surv.luke.1 ~ cmv, data=data)
model.base.donorcmv <- coxph(surv.luke.1 ~ donorcmv, data=data)
model.base.waittime <- coxph(surv.luke.1 ~ waittime, data=data)
model.base.disgroup <- coxph(surv.luke.1 ~ disgroup, data=data)
model.base.fab <- coxph(surv.luke.1 ~ fab, data=data)
model.base.mtx <- coxph(surv.luke.1 ~ mtx, data=data)
summary(model.base.age)
summary(model.base.male)
summary(model.base.donorage)
summary(model.base.donormale)
summary(model.base.cmv)
summary(model.base.donorcmv)
summary(model.base.waittime)
summary(model.base.disgroup)
summary(model.base.fab)
summary(model.base.mtx)
summary(model.base.age)
est.male <- coef(model.base.age)["Pr(>|z|)"]
est.male
est.male <- coef(model.base.age)["Pr(>|z|)"]
summary(model.base.age)
est.male <- summary(model.base.age)["Pr(>|z|)"]
est.male <- summary(model.base.age)["Pr(>|z|)"]
est.male
summary(model.base.age)
est.male <- summary(model.base.age)[1,5]
est.male <- summary(model.base.age)[5,1]
summary(model.base.age)
est.male <- summary(model.base.age)["Pr(>|z|)", 1]
est.male <- summary(model.base.age)[1, "Pr(>|z|)"]
est.male <- summary(model.base.age)["Pr(>|z|)", ]
est.male <- summary(model.base.age)[, "Pr(>|z|)"]
